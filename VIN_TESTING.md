# VIN Auto-fill Testing Guide

## Что было реализовано

✅ **VIN Auto-fill** - автоматическое заполнение полей при вводе VIN номера
✅ **API интеграция** - подключение к NHTSA VPIC API для декодирования VIN
✅ **Визуальная обратная связь** - индикатор загрузки и цветовая подсветка
✅ **Валидация** - проверка формата VIN (17 символов, без I/O/Q)
✅ **Обработка ошибок** - понятные сообщения об ошибках для пользователя
✅ **Логирование** - подробные логи в консоли браузера для отладки

## Как протестировать

### 1. Запустите приложение
```powershell
python run.py
```

### 2. Откройте страницу Work Orders
- Перейдите на http://localhost:5000
- Войдите в систему
- Перейдите в раздел "Work Orders"
- Нажмите кнопку для создания нового Work Order

### 3. Тестовые VIN номера

**Валидные VIN для тестирования:**
- `1HGBH41JXMN109186` - Honda Accord
- `5UXWX7C5*BA` - BMW X5 (2011)
- `WBAVD13596KX00000` - BMW 3-series
- `1G1YY25R795123456` - Chevrolet Corvette
- `JH4DA3340LS000000` - Acura Integra

**Невалидные VIN (для проверки валидации):**
- `123` - слишком короткий
- `12345678901234567890` - слишком длинный
- `1HGBH41JXMN10918I` - содержит недопустимый символ I
- `1HGBH41JXMN10918O` - содержит недопустимый символ O

### 4. Что должно происходить

1. **При вводе VIN:**
   - Текст автоматически конвертируется в верхний регистр
   - При достижении 17 символов появляется синяя подсветка
   - Показывается индикатор загрузки (spinner)

2. **При успешном декодировании:**
   - Поля Make, Model, Year, Type автоматически заполняются
   - Поле VIN подсвечивается зелёным на 1.5 секунды
   - В консоли браузера появляются логи успешного декодирования

3. **При ошибке:**
   - Показывается alert с описанием ошибки
   - Поле VIN подсвечивается красным на 2 секунды
   - В консоли браузера логируется ошибка

## Консольные логи

Откройте Developer Tools (F12) → Console для просмотра логов:

```
[VIN] Starting lookup for: 1HGBH41JXMN109186
[VIN] Fetching details for: 1HGBH41JXMN109186
[VIN] Received data: {ok: true, vin: "1HGBH41JXMN109186", make: "HONDA", model: "Accord", year: "1991", type: "PASSENGER CAR"}
[VIN] Autofilling fields with data: {ok: true, ...}
[VIN] Set Make: HONDA
[VIN] Set Model: Accord
[VIN] Set Year: 1991
[VIN] Set Type: PASSENGER CAR
```

## Серверные логи

В терминале Flask должны появляться логи:

```
[VIN API] Successfully decoded 1HGBH41JXMN109186: 1991 HONDA Accord
```

## Возможные проблемы и решения

### VIN не декодируется
- Проверьте интернет-соединение (API внешний)
- Убедитесь, что VIN корректный (17 символов)
- Проверьте консоль браузера на ошибки

### Поля не заполняются
- Откройте консоль браузера (F12)
- Проверьте логи с префиксом `[VIN]`
- Убедитесь, что элементы с ID существуют на странице

### API возвращает ошибку 401/403
- Проверьте что вы залогинены
- Убедитесь что у пользователя есть права `work_orders.create`

## Используемый API

**NHTSA VPIC API:**
- URL: https://vpic.nhtsa.dot.gov/api/
- Документация: https://vpic.nhtsa.dot.gov/api/
- Бесплатный, без ограничений по количеству запросов
- Данные обновляются регулярно

## Код

**Backend:** `app/blueprints/work_orders/vin_api.py`
**Frontend:** `app/static/js/work_orders/work_order_details.js` (функция `fetchVinDetails`, `debouncedVinLookup`)
**HTML:** `app/templates/public/work_orders/work_order_details.html` (модальное окно создания Unit)
