{% extends "layouts/app_base.html" %}
{% block page_title %}Parts Settings{% endblock %}

{% block app_content %}

<div class="card mb-3">
  <div class="card-body">
    <h1 class="h4 mb-1">Parts Settings</h1>
    <p class="text-muted mb-0">Manage parts locations and categories.</p>

    {% if error_message %}
      <div class="alert alert-warning mt-3 mb-0">{{ error_message }}</div>
    {% endif %}
  </div>
</div>

<div class="row g-3">

  <!-- Parts Locations -->
  <div class="col-12 col-xl-6">
    <div class="card h-100">
      <div class="card-body">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <h2 class="h6 mb-0">Parts Locations</h2>
        </div>

        <!-- Create -->
        <form method="post" action="{{ url_for('settings.parts_locations_create') }}" class="row g-2 mb-3">
          <div class="col-12 col-md-8">
            <input type="text" name="name" class="form-control" placeholder="New location name" required>
          </div>
          <div class="col-12 col-md-4">
            <button class="btn btn-primary w-100" type="submit">Add</button>
          </div>
        </form>

        {% if parts_locations and parts_locations|length > 0 %}
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th style="width: 60%;">Name</th>
                  <th class="text-end" style="width: 40%;">Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for loc in parts_locations %}
                  {% set loc_id = loc._id|string %}
                  <tr>
                    <td>
                      {% if edit_location_id == loc_id %}
                        <form method="post" action="{{ url_for('settings.parts_locations_update', location_id=loc_id) }}" class="d-flex gap-2">
                          <input type="text" name="name" class="form-control form-control-sm" value="{{ loc.name }}" required>
                          <button class="btn btn-sm btn-success" type="submit">Save</button>
                          <a class="btn btn-sm btn-outline-secondary"
                             href="{{ url_for('settings.parts_settings_index') }}">Cancel</a>
                        </form>
                      {% else %}
                        {{ loc.name }}
                      {% endif %}
                    </td>
                    <td class="text-end">
                      {% if edit_location_id != loc_id %}
                        <a class="btn btn-sm btn-outline-primary"
                           href="{{ url_for('settings.parts_settings_index', edit_location_id=loc_id) }}">Edit</a>

                        <form method="post"
                              action="{{ url_for('settings.parts_locations_delete', location_id=loc_id) }}"
                              class="d-inline"
                              onsubmit="return confirm('Delete this location?');">
                          <button class="btn btn-sm btn-outline-danger" type="submit">Delete</button>
                        </form>
                      {% endif %}
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="text-muted">No locations yet.</div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Parts Categories -->
  <div class="col-12 col-xl-6">
    <div class="card h-100">
      <div class="card-body">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <h2 class="h6 mb-0">Parts Categories</h2>
        </div>

        <!-- Create -->
        <form method="post" action="{{ url_for('settings.parts_categories_create') }}" class="row g-2 mb-3">
          <div class="col-12 col-md-8">
            <input type="text" name="name" class="form-control" placeholder="New category name" required>
          </div>
          <div class="col-12 col-md-4">
            <button class="btn btn-primary w-100" type="submit">Add</button>
          </div>
        </form>

        {% if parts_categories and parts_categories|length > 0 %}
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th style="width: 60%;">Name</th>
                  <th class="text-end" style="width: 40%;">Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for cat in parts_categories %}
                  {% set cat_id = cat._id|string %}
                  <tr>
                    <td>
                      {% if edit_category_id == cat_id %}
                        <form method="post" action="{{ url_for('settings.parts_categories_update', category_id=cat_id) }}" class="d-flex gap-2">
                          <input type="text" name="name" class="form-control form-control-sm" value="{{ cat.name }}" required>
                          <button class="btn btn-sm btn-success" type="submit">Save</button>
                          <a class="btn btn-sm btn-outline-secondary"
                             href="{{ url_for('settings.parts_settings_index') }}">Cancel</a>
                        </form>
                      {% else %}
                        {{ cat.name }}
                      {% endif %}
                    </td>
                    <td class="text-end">
                      {% if edit_category_id != cat_id %}
                        <a class="btn btn-sm btn-outline-primary"
                           href="{{ url_for('settings.parts_settings_index', edit_category_id=cat_id) }}">Edit</a>

                        <form method="post"
                              action="{{ url_for('settings.parts_categories_delete', category_id=cat_id) }}"
                              class="d-inline"
                              onsubmit="return confirm('Delete this category?');">
                          <button class="btn btn-sm btn-outline-danger" type="submit">Delete</button>
                        </form>
                      {% endif %}
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="text-muted">No categories yet.</div>
        {% endif %}
      </div>
    </div>
  </div>

</div>

{% endblock %}
